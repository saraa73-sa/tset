<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„ØªØ³Ù…ÙŠØ¹</title>
<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">
<style>
body { background:#f5f3ee; font-family:'Cairo', Tahoma, Arial; margin:0; padding:40px; }
.card { max-width:600px; margin:auto; background:#fff; border-radius:16px; box-shadow:0 15px 40px rgba(0,0,0,0.08); overflow:hidden; }
.header { background:linear-gradient(135deg,#065f46,#047857); color:white; text-align:center; padding:32px 20px; }
.header h1 { margin:0; font-size:28px; font-weight:700; }
.header p { margin-top:10px; font-size:14px; opacity:0.9; }
form { padding:30px; }
.field { margin-bottom:22px; }
label { display:block; font-weight:600; margin-bottom:6px; color:#064e3b; }
label span { color:#b91c1c; }
small { display:block; color:#555; font-size:13px; margin-bottom:8px; line-height:1.6; }
input[type="text"], input[type="number"], select { width:100%; padding:12px; border-radius:10px; border:1px solid #d1d5db; font-size:14px; font-family:'Cairo'; box-sizing:border-box; }
select { cursor:pointer; }
button { width:100%; background:#065f46; color:white; border:none; padding:14px; border-radius:12px; font-size:16px; font-family:'Cairo'; font-weight:600; cursor:pointer; transition:0.3s; }
button:hover { background:#047857; }
.footer { text-align:center; padding:18px; font-size:14px; color:#065f46; background:#f0fdf4; }
.row { display:flex; gap:10px; }
.row select { flex:1; }
.row input {  margin-bottom:6px;}
.custom-select {
  position: relative;
  flex: 1;
}

.selected {
  padding: 12px;
  border: 1px solid #d1d5db;
  border-radius: 10px;
  background: #fff;
  cursor: pointer;
}

.dropdown {
  display: none;
  position: absolute;
  top: 105%;
  right: 0;
  left: 0;
  background: white;
  border: 1px solid #d1d5db;
  border-radius: 10px;
  max-height: 260px;
  overflow: hidden;
  z-index: 20;
}

.dropdown input {
  border: none;
  border-bottom: 1px solid #e5e7eb;
  padding: 10px;
  width: 100%;
  outline: none;
}

.dropdown ul {
  list-style: none;
  margin: 0;
  padding: 0;
  max-height: 200px;
  overflow-y: auto;
}

.dropdown li {
  padding: 10px;
  cursor: pointer;
}

.dropdown li:hover {
  background: #f0fdf4;
}

.toast {
  position: fixed;
  bottom: 24px;
  right: 50%;
  transform: translateX(50%);
  min-width: 260px;
  max-width: 90%;
  padding: 14px 18px;
  border-radius: 12px;
  font-family: 'Cairo';
  font-size: 15px;
  font-weight: 600;
  text-align: center;
  color: white;
  z-index: 9999;
  opacity: 0;
  pointer-events: none;
  transition: all 0.4s ease;
}

.toast.show {
  opacity: 1;
  bottom: 40px;
}

.toast.success {
  background: #059669;
}

.toast.error {
  background: #dc2626;
}

.toast.info {
  background: #065f46;
}

.custom-select {
  position: relative;
}

.dropdown {
  display: none;
  position: absolute;
  background: white;
  width: 100%;
  border: 1px solid #ccc;
  z-index: 999;
  max-height: 250px;
  overflow-y: auto;
}

.dropdown ul {
  list-style: none;
  padding: 0;
  margin: 0;
}

.dropdown li {
  padding: 10px;
  cursor: pointer;
}

.dropdown li:hover {
  background: #f3f4f6;
}

.selected {
  padding: 12px;
  border: 1px solid #ccc;
  cursor: pointer;
  background: #fff;
}

.result-box {
  margin-top:10px; 
  padding:10px; 
  background:#f0fdf4; 
  border:1px solid #065f46;  /* Ø§Ù„Ù„ÙˆÙ† Ø§Ù„Ø·Ø¨ÙŠØ¹ÙŠ */
  border-radius:6px; 
  color:#065f46; 
  font-weight:600; 
  text-align:center; 
  transition: border-color 0.3s ease, color 0.3s ease; /* ØªØ£Ø«ÙŠØ± Ø³Ù„Ø³ */
}

</style>
</head>
<body>
  <div class="card">
  <div class="header">
    <h1>Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„ØªØ³Ù…ÙŠØ¹</h1>
    <p>ØªØ³Ø¬ÙŠÙ„ Ø­ØµØ§Ø¯ Ø§Ù„Ø·Ø§Ù„Ø¨Ø©</p>
  </div>

  <form id="tasmeeForm">
    <!-- Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨Ø© -->
    <div class="field">
      <label>Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨Ø© Ø§Ù„Ø«Ù„Ø§Ø«ÙŠ <span>*</span></label>
      <input type="text" id="tasmeeName" required>
    </div>

    <!-- Ø§Ù„Ø¯Ø±Ø³ -->
    <div class="field">
      <label>Ø§Ù„Ø¯Ø±Ø³</label>
      <small>Ø¥Ø°Ø§ Ù„Ù… ÙŠÙˆØ¬Ø¯ Ù„Ø¯ÙŠÙƒ Ø¯Ø±Ø³ Ø§ØªØ±Ùƒ Ø§Ù„Ø®Ø§Ù†Ø© ÙØ§Ø±ØºØ©</small>
      <input type="text" id="tasmeeLesson">
    </div>

    <!-- Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø© -->
    <div class="field">
      <label>Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©</label>
      <small>Ø¥Ø°Ø§ Ù„Ù… ØªÙˆØ¬Ø¯ Ù„Ø¯ÙŠÙƒ Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§ØªØ±Ùƒ Ø§Ù„Ø®Ø§Ù†Ø© ÙØ§Ø±ØºØ©</small>
      <input type="text" id="tasmeeReview">
    </div>

    <!-- Ø­Ø³Ø§Ø¨ Ø¹Ø¯Ø¯ Ø§Ù„Ø£ÙˆØ¬Ù‡ -->
    <div class="field">
      <label>Ø­Ø³Ø§Ø¨ Ø¹Ø¯Ø¯ Ø§Ù„Ø£ÙˆØ¬Ù‡</label>
      <small>Ø§Ø®ØªØ± Ø§Ù„Ø³ÙˆØ± Ø£Ø¯Ù†Ø§Ù‡ Ù„ÙŠØªÙ… Ø§Ù„Ø­Ø³Ø§Ø¨ ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§</small>

      <div class="row">
        <!-- Ø³ÙˆØ±Ø© Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© -->
        <div id="startBox" class="custom-select">
          <div class="selected" onclick="toggleList('start')">Ø§Ø®ØªØ± Ø³ÙˆØ±Ø© Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©</div>
          <div class="dropdown">
            <input type="text" placeholder="Ø¨Ø­Ø«..." oninput="filterSurahs(this,'start')" />
            <ul></ul>
          </div>
          <input type="hidden" id="startSurah">
        </div>

        <!-- Ø³ÙˆØ±Ø© Ø§Ù„Ù†Ù‡Ø§ÙŠØ© -->
        <div id="endBox" class="custom-select">
          <div class="selected" onclick="toggleList('end')">Ø§Ø®ØªØ± Ø³ÙˆØ±Ø© Ø§Ù„Ù†Ù‡Ø§ÙŠØ©</div>
          <div class="dropdown">
            <input type="text" placeholder="Ø¨Ø­Ø«..." oninput="filterSurahs(this,'end')" />
            <ul></ul>
          </div>
          <input type="hidden" id="endSurah">
        </div>
      </div>

      <!-- Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡ ÙˆØ§Ù„Ù†ØªØ§Ø¦Ø¬ -->
      <div class="warning" id="surahWarning">âš ï¸ Ø³ÙˆØ±Ø© Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† Ù‚Ø¨Ù„ Ø³ÙˆØ±Ø© Ø§Ù„Ù†Ù‡Ø§ÙŠØ© </div>
      <div id="facesBox" class="result-box">
        <input type="hidden" id="tasmeeFaces" name="faces">
        <span id="facesResult">0</span> ÙˆØ¬Ù‡
      </div>
    </div>

    <!-- Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø© -->
    <div id="toast" class="toast"></div>

    <button type="submit">Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©</button>
  </form>

  <div class="footer">Ù†Ø³Ø£Ù„ Ø§Ù„Ù„Ù‡ Ø§Ù„ØªÙˆÙÙŠÙ‚ ÙˆØ§Ù„Ø³Ø¯Ø§Ø¯ ğŸŒ¿</div>
</div>

<script>
const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbxPpnbLZOdYP5wp0ngxaziObsY_OYkBAzDqHsc-zvOwqH-eowTQIry665bYiFGofBnp/exec";

/* ===============================
   ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø³ÙˆØ±
================================ */
window.addEventListener("load", () => {
  fetch(`${WEB_APP_URL}?action=surahs`)
    .then(r => r.json())
    .then(populateDropdowns)
    .catch(() => showToast("âŒ ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø³ÙˆØ±", "error"));
});

let surahList = [];

/* ===============================
   ØªØ¹Ø¨Ø¦Ø© Ø§Ù„Ù‚ÙˆØ§Ø¦Ù…
================================ */
function populateDropdowns(surahs = []) {
  surahList = surahs;
  fillCustomList("start");
  fillCustomList("end");

  if (surahs.length) {
    setSurah("start", surahs[0].name);
    setSurah("end", surahs[surahs.length - 1].name);
  }
}

/* ===============================
   Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù‚ÙˆØ§Ø¦Ù…
================================ */
function fillCustomList(type) {
  const ul = document.querySelector(`#${type}Box ul`);
  ul.innerHTML = "";
  surahList.forEach(s => {
    const li = document.createElement("li");
    li.textContent = s.name;
    li.onclick = () => setSurah(type, s.name);
    ul.appendChild(li);
  });
}

function setSurah(type, name) {
  document.getElementById(type + "Surah").value = name;
  document.querySelector(`#${type}Box .selected`).textContent = name;
  document.querySelector(`#${type}Box .dropdown`).style.display = "none";
  calculateFaces();
}

/* ===============================
   Ø­Ø³Ø§Ø¨ Ø§Ù„Ø£ÙˆØ¬Ù‡
================================ */
function calculateFaces() {
  const start = startSurah.value;
  const end = endSurah.value;
  if (!start || !end) return;

  fetch(`${WEB_APP_URL}?action=faces&start=${encodeURIComponent(start)}&end=${encodeURIComponent(end)}`)
    .then(r => r.json())
    .then(res => {
      facesResult.textContent = res.faces || 0;
      tasmeeFaces.value = res.faces || 0;
    })
    .catch(() => showToast("âŒ ÙØ´Ù„ Ø­Ø³Ø§Ø¨ Ø§Ù„Ø£ÙˆØ¬Ù‡", "error"));
}

/* ===============================
   ÙØªØ­ / Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©
================================ */
function toggleList(type) {
  const box = document.getElementById(type + "Box");
  const dropdown = box.querySelector(".dropdown");

  // Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù‚ÙˆØ§Ø¦Ù… Ø§Ù„Ø£Ø®Ø±Ù‰
  document.querySelectorAll(".dropdown").forEach(d => {
    if (d !== dropdown) d.style.display = "none";
  });

  dropdown.style.display =
    dropdown.style.display === "block" ? "none" : "block";
}

/* Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù‚ÙˆØ§Ø¦Ù… Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ· Ø®Ø§Ø±Ø¬Ù‡Ø§ */
document.addEventListener("click", e => {
  if (!e.target.closest(".custom-select")) {
    document.querySelectorAll(".dropdown").forEach(d => {
      d.style.display = "none";
    });
  }
});

  /* ===============================
Ø¯Ø§Ù„Ø© Ø§Ù„Ø¨Ø­Ø« Ù„ØªØµÙÙŠØ© Ø§Ù„Ø³ÙˆØ± Ø¯Ø§Ø®Ù„ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©
  ================================ */
/* ===============================
   Ø¯Ø§Ù„Ø© Ø§Ù„Ø¨Ø­Ø« Ø§Ù„Ø°ÙƒÙŠ (ØªØ¬Ø§Ù‡Ù„ Ø§Ù„Ù‡Ù…Ø²Ø§Øª)
================================ */
function filterSurahs(input, type) {
  // Ø¯Ø§Ù„Ø© Ù„ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ù†Øµ Ù…Ù† Ø§Ù„Ù‡Ù…Ø²Ø§Øª ÙˆØ§Ù„ØªØ´ÙƒÙŠÙ„
  const normalize = (text) => {
    return text
      .replace(/[Ø£Ø¥Ø¢Ø£]/g, "Ø§")
      .replace(/Ø©/g, "Ù‡")
      .replace(/Ù‰/g, "ÙŠ")
      .replace(/[\u064B-\u065F]/g, ""); // Ø­Ø°Ù Ø§Ù„ØªØ´ÙƒÙŠÙ„ Ø¥Ù† ÙˆØ¬Ø¯
  };

  const filter = normalize(input.value.trim());
  const ul = document.querySelector(`#${type}Box ul`);
  const li = ul.getElementsByTagName("li");

  for (let i = 0; i < li.length; i++) {
    const text = normalize(li[i].textContent || li[i].innerText);
    // Ø§Ù„Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ù†Øµ Ø§Ù„Ù…Ù†Ø¸Ù
    if (text.includes(filter)) {
      li[i].style.display = "";
    } else {
      li[i].style.display = "none";
    }
  }
}


  

/* ===============================
   Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
================================ */
tasmeeForm.addEventListener("submit", e => {
  e.preventDefault();

  if (+tasmeeFaces.value <= 0) {
    showToast("âŒ Ø¹Ø¯Ø¯ Ø§Ù„Ø£ÙˆØ¬Ù‡ ØºÙŠØ± ØµØ­ÙŠØ­", "error");
    return;
  }

  const data = new URLSearchParams({
    action: "tasmee",
    name: tasmeeName.value.trim(),
    lesson: tasmeeLesson.value.trim(),
    review: tasmeeReview.value.trim(),
    faces: tasmeeFaces.value,
    startSurah: startSurah.value,
    endSurah: endSurah.value
  });

  fetch(WEB_APP_URL, {
    method: "POST",
    body: data
  })
  .then(r => r.text())
  .then(msg => {
    if (msg.startsWith("âŒ")) throw new Error(msg);
    showToast("âœ”ï¸ ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„ØªØ³Ù…ÙŠØ¹ Ø¨Ù†Ø¬Ø§Ø­", "success");
    tasmeeForm.reset();
  })
  .catch(() => showToast("âŒ ÙØ´Ù„ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„", "error"));
});

/* ===============================
   Toast
================================ */
function showToast(msg, type) {
  toast.textContent = msg;
  toast.className = `toast show ${type}`;
  setTimeout(() => toast.classList.remove("show"), 3000);
}
</script>

</body>
</html>
