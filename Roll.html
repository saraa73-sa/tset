<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ø¯ÙˆØ±</title>
<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">
<style>
body { background:#f5f3ee; font-family:'Cairo', Tahoma, Arial; margin:0; padding:40px; }
.card { max-width:600px; margin:auto; background:#fff; border-radius:16px; box-shadow:0 15px 40px rgba(0,0,0,0.08); overflow:hidden; }
.header { background:linear-gradient(135deg,#065f46,#047857); color:white; text-align:center; padding:32px 20px; }
.header h1 { margin:0; font-size:28px; font-weight:700; }
.header p { margin-top:10px; font-size:14px; opacity:0.9; }
form { padding:30px; }
.field { margin-bottom:22px; }
label { display:block; font-weight:600; margin-bottom:6px; color:#064e3b; }
label span { color:#b91c1c; }
input[type="text"], select {
  width:100%;
  padding:12px;
  border-radius:10px;
  border:1px solid #d1d5db;
  font-size:14px;
  font-family:'Cairo';
}
button { width:100%; background:#065f46; color:white; border:none; padding:14px; border-radius:12px; font-size:16px; font-family:'Cairo'; font-weight:600; cursor:pointer; transition:0.3s; }
button:hover { background:#047857; }
.footer { text-align:center; padding:18px; font-size:14px; color:#065f46; background:#f0fdf4; }
</style>
</head>
<body>

<div class="card">
  <div class="header">
    <h1>Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ø¯ÙˆØ±</h1>
    <p>ØªØ³Ø¬ÙŠÙ„ Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨Ø© ÙˆØ±Ù‚Ù… Ø§Ù„Ø¯ÙˆØ±</p>
  </div>

  <form id="dorForm">
    <div class="field">
      <label>Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨Ø© Ø§Ù„Ø«Ù„Ø§Ø«ÙŠ <span>*</span></label>
      <input type="text" id="dorName" required placeholder="Ø£Ø¯Ø®Ù„ÙŠ Ø§Ø³Ù…Ùƒ Ø§Ù„Ø«Ù„Ø§Ø«ÙŠ">
    </div>
    <div class="field">
      <label>Ø±Ù‚Ù… Ø§Ù„Ø¯ÙˆØ± <span>*</span></label>
      <select id="dorNumber" required>
        <option value="">â³ Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£Ø±Ù‚Ø§Ù… Ø§Ù„Ù…ØªØ§Ø­Ø©...</option>
      </select>
    </div>
    <button type="submit" id="submitBtn">Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©</button>
  </form>

  <div class="footer">Ù†Ø³Ø£Ù„ Ø§Ù„Ù„Ù‡ Ø§Ù„ØªÙˆÙÙŠÙ‚ ÙˆØ§Ù„Ø³Ø¯Ø§Ø¯ ğŸŒ¿</div>
</div>

<script>
const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbz63m4J4O_C8zZC2Lsuyvi1tMbvUz1vO4bkfi-KJQvHw9AFtsTKdBxmwSJj7j_OqnVD/exec"; // â† Ø¶Ø¹ Ø±Ø§Ø¨Ø·Ùƒ Ù‡Ù†Ø§


// 1) Ø¬Ù„Ø¨ Ø§Ù„Ø£Ø±Ù‚Ø§Ù… Ø§Ù„Ù…ØªØ§Ø­Ø©
function loadAvailableNumbers() {
  const select = document.getElementById("dorNumber");

  fetch(WEB_APP_URL + "?action=getNumbers")
    .then(r => r.json())
    .then(numbers => {
      select.innerHTML = '<option value="">Ø§Ø®ØªØ± Ø§Ù„Ø±Ù‚Ù…</option>';

      if (!numbers || numbers.length === 0) {
        select.innerHTML = '<option value="">âš ï¸ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£Ø±Ù‚Ø§Ù… Ù…ØªØ§Ø­Ø©</option>';
      } else {
        numbers.forEach(num => {
          const opt = document.createElement("option");
          opt.value = num;
          opt.textContent = num;
          select.appendChild(opt);
        });
      }
    })
    .catch(() => {
      select.innerHTML = '<option value="">âš ï¸ ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£Ø±Ù‚Ø§Ù…</option>';
    });
}

window.onload = loadAvailableNumbers;


// 2) Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
document.getElementById("dorForm").addEventListener("submit", function(e) {
  e.preventDefault();

  const btn = document.getElementById("submitBtn");
  const name = document.getElementById("dorName").value.trim();
  const number = document.getElementById("dorNumber").value;

  if (!name || !number) return;

  btn.disabled = true;
  btn.textContent = "â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø­Ø¬Ø² ÙˆØ§Ù„ØªØ­Ù‚Ù‚...";
  btn.style.backgroundColor = "#9ca3af";

fetch(WEB_APP_URL, {
  method: "POST",
  headers: {
    "Content-Type": "application/json"
  },
  body: JSON.stringify({
    action: "roll",
    name: name,
    rollNumber: rollNumber
  })
});
  .then(r => r.text())
  .then(msg => {
    if (msg.startsWith("âŒ")) throw new Error(msg);

    btn.textContent = "âœ”ï¸ ØªÙ… Ø§Ù„Ø­Ø¬Ø² Ø¨Ù†Ø¬Ø§Ø­";
    btn.style.backgroundColor = "#059669";

    document.getElementById("dorName").value = "";
    loadAvailableNumbers();

    setTimeout(() => {
      btn.disabled = false;
      btn.textContent = "Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©";
      btn.style.backgroundColor = "#065f46";
    }, 5000);
  })
  .catch(err => {
    btn.textContent = err.message.replace("âŒ", "âŒ ");
    btn.style.backgroundColor = "#dc2626";

    setTimeout(() => {
      btn.disabled = false;
      btn.textContent = "Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©";
      btn.style.backgroundColor = "#065f46";
      loadAvailableNumbers();
    }, 10000);
  });
});
</script>

</body>
</html>
